#!/bin/sh -e

case $(auto-ostype) in
FreeBSD)
    auto-fusefs-install
    pkg install -y automount npmount qmediamanager
    cat << EOM > /usr/local/etc/automount.conf
FM=/usr/local/bin/qmediamanager
MNT_GROUP=operator
MNT_MODE=775
EOM
    service devd restart
    ;;

NetBSD)
    auto-fusefs-install
    # These may not be available in binary packages yet
    # Install from wip if necessary
    pkgin install -y automount npmount qmediamanager || true
    cat << EOM > $(auto-pkgsrc-prefix)/etc/automount.conf
FM=$(auto-pkgsrc-prefix)/bin/qmediamanager
MNT_GROUP=operator
MNT_MODE=775
EOM
    cp -f $(auto-pkgsrc-prefix)/share/automount-devpubd/03-automount /libexec/devpubd-hooks/
    auto-enable-service devpubd
    ;;

*)
    auto-unsupported-os $0
    exit 1
    ;;

esac
